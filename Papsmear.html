<html>

<head>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/muzima.css" rel="stylesheet">
    <link href="css/ui-darkness/jquery-ui-1.10.4.custom.min.css" rel="stylesheet">
    <script src="js/jquery.min.js"></script>
    <script src="js/jquery-ui-1.10.4.custom.min.js"></script>
    <script src="js/jquery.validate.min.js"></script>
    <script src="js/additional-methods.min.js"></script>
    <script src="js/muzima.js"></script>

    <title>Papsmear Form</title>
</head>

<body class="col-md-8 col-md-offset-2">
<div id="pre_populate_data"></div>
<form id="via_form" name="via_form">
<h2 class="text-center">Papsmear Form</h2>

<div class="section">
    <h3>Demographics</h3>

    <div class="form-group">
        <input class="form-control" id="patient.uuid" name="patient.uuid" type="hidden" readonly="readonly">
    </div>
    <div class="form-group">
        <label for="patient.medical_record_number">AMRS ID Number:</label>
        <input class="form-control" id="patient.medical_record_number" name="patient.medical_record_number"
               type="text" readonly="readonly">
    </div>
    <div class="form-group">
        <label for="patient.family_name">Family Name:</label>
        <input class="form-control" id="patient.family_name" name="patient.family_name" type="text"
               readonly="readonly">
    </div>
    <div class="form-group">
        <label for="patient.given_name">Given Name:</label>
        <input class="form-control" id="patient.given_name" name="patient.given_name" type="text"
               readonly="readonly">
    </div>
    <div class="form-group">
        <label for="patient.middle_name">Middle Name:</label>
        <input class="form-control" id="patient.middle_name" name="patient.middle_name" type="text"
               readonly="readonly">
    </div>
    <div class="form-group">
        <label for="patient.sex">Gender:</label>
        <select class="form-control" id="patient.sex" name="patient.sex" readonly="readonly">
            <option value="">...</option>
            <option value="M">Male</option>
            <option value="F">Female</option>
        </select>
    </div>
    <div class="form-group">
        <label for="patient.birthdate">Date Of Birth:</label>
        <input class="form-control datepicker nonFutureDate" id="patient.birthdate" name="patient.birthdate"
               type="date" readonly="readonly">
    </div>
</div>
<div class="section">
    <h3>Encounter Details</h3>

    <div class="form-group">
        <label for="encounter.location_id">Screening Site:<span class="required">*</span>
        </label>
        <input class="form-control" id="encounter.location_id" type="text" placeholder="Start typing something...">
        <input class="form-control" name="encounter.location_id" type="hidden">
    </div>

    <div class="form-group">
        <label for="encounter.provider_id_select">Provider ID:</label>
        <input class="form-control" id="encounter.provider_id_select" type="text"
               placeholder="Start typing something...">
        <input class="form-control" name="encounter.provider_id_select" type="hidden">
    </div>

    <div class="form-group show_provider_id_text">
        <label for="encounter.provider_id">Enter provider's system-id:<span class="required">*</span></label>
        <input class="form-control checkDigit" id="encounter.provider_id" name="encounter.provider_id" type="text"
               required="required">
    </div>
    <div class="form-group">
        <label for="encounter.encounter_datetime">Encounter Date:<span class="required">*</span></label>
        <input class="form-control datepicker nonFutureDate" id="encounter.encounter_datetime"
               name="encounter.encounter_datetime" type="text" readonly="readonly" encounter.encounter_datetime
               required="required">
    </div>
    <div class="form-group">
        <input class="form-control" id="encounter.form_uuid" name="encounter.form_uuid" type="hidden"
               required="required">
    </div>
</div>
<div class="section">
    <h3>Observation Details </h3>

    <div class="section">
        <div class="form-group">
            <label for="obs.last_menstrual_period_date">First day of your last menstrual period (LMP)</label>
            <input class="form-control datepicker nonFutureDate" id="obs.last_menstrual_period_date"
                   name="last_menstrual_period_date" type="date" data-concept="1836^LAST MENSTRUAL PERIOD DATE^99DCT"
                   required="required">
        </div>
    </div>

    <div class="section">
        <div class="form-group">
            <label>Complaints (Select all symptoms that best describe complaints)</label>
            <fieldset name="5219^CHIEF COMPLAINT^99DCT" data-concept="5219^CHIEF COMPLAINT^99DCT">

                <input id="chief_complaint.symptomatic" type="checkbox" name="5219^CHIEF COMPLAINT^99DCT"
                       value="1068^SYMPTOMATIC^99DCT">
                <label for="chief_complaint.symptomatic">Symptomatic</label><br/>

                <input id="chief_complaint.asymptomatic" type="checkbox" name="5219^CHIEF COMPLAINT^99DCT"
                       value="5006^ASYMPTOMATIC^99DCT">
                <label for="chief_complaint.asymptomatic">Asymptomatic</label><br/>

                <input id="chief_complaint.having_hypoglycemia_symptoms_in_past_month" type="checkbox"
                       name="5219^CHIEF COMPLAINT^99DCT"
                       value="8008^HAVING HYPOGLYCEMIA SYMPTOMS IN PAST MONTH^99DCT">
                <label for="chief_complaint.having_hypoglycemia_symptoms_in_past_month">
                    Having hypoglycemia symptoms in past month
                </label><br/>

                <input id="chief_complaint.vaginal_discharge" type="checkbox" name="5219^CHIEF COMPLAINT^99DCT"
                       value="5993^VAGINAL DISCHARGE^99DCT">
                <label for="chief_complaint.vaginal_discharge">Vaginal discharge</label><br/>

                <input id="chief_complaint.vaginal_bleeding" type="checkbox" name="5219^CHIEF COMPLAINT^99DCT"
                       value="1489^VAGINAL BLEEDING^99DCT">
                <label for="chief_complaint.vaginal_bleeding">Vaginal bleeding</label><br/>

                <input id="chief_complaint.dysfunctional_uterine_bleeding" type="checkbox"
                       name="5219^CHIEF COMPLAINT^99DCT"
                       value="6497^DYSFUNCTIONAL UTERINE BLEEDING^99DCT">
                <label for="chief_complaint.dysfunctional_uterine_bleeding">Dysfunctional uterine bleeding</label><br/>

                <input id="chief_complaint.menorrhagia" type="checkbox" name="5219^CHIEF COMPLAINT^99DCT"
                       value="1461^MENORRHAGIA^99DCT">
                <label for="chief_complaint.menorrhagia">Menorrhagia</label><br/>

                <input id="chief_complaint.postmenopausal_bleeding" type="checkbox" name="5219^CHIEF COMPLAINT^99DCT"
                       value="8274^POSTMENOPAUSAL BLEEDING^99DCT">
                <label for="chief_complaint.postmenopausal_bleeding">Postmenopausal bleeding</label><br/>

                <input id="chief_complaint.postcoital_bleeding" type="checkbox" name="5219^CHIEF COMPLAINT^99DCT"
                       value="8273^POSTCOITAL BLEEDING^99DCT">
                <label for="chief_complaint.postcoital_bleeding">Postcoital bleeding</label><br/>

                <input id="chief_complaint.other_non_coded" type="checkbox" name="5219^CHIEF COMPLAINT^99DCT"
                       value="5622^OTHER NON-CODED^99DCT">
                <label for="chief_complaint.other_non_coded">Other non-coded</label><br/>

                <input id="chief_complaint.none" type="checkbox" name="5219^CHIEF COMPLAINT^99DCT"
                       value="1107^NONE^99DCT">
                <label for="chief_complaint.none">None</label><br/>
            </fieldset>
        </div>
    </div>

    <div class="section">
        <div class="form-group">
            <label>Current family planning method</label>
            <fieldset name="374^METHOD OF FAMILY PLANNING^99DCT" data-concept="374^METHOD OF FAMILY PLANNING^99DCT">
                <input id="method_of_family_planning.condoms" type="checkbox" name="374^METHOD OF FAMILY PLANNING^99DCT"
                       value="190^CONDOMS^99DCT">
                <label for="method_of_family_planning.condoms">Condoms</label><br/>

                <input id="method_of_family_planning.female_sterilization" type="checkbox"
                       name="374^METHOD OF FAMILY PLANNING^99DCT" value="5276^FEMALE STERILIZATION^99DCT">
                <label for="method_of_family_planning.female_sterilization">Sterilization / Hysterectomy</label><br/>

                <input id="method_of_family_planning.intrauterine_device" type="checkbox"
                       name="374^METHOD OF FAMILY PLANNING^99DCT" value="5275^INTRAUTERINE DEVICE^99DCT">
                <label for="method_of_family_planning.intrauterine_device">Intrauterine device</label><br/>

                <input id="method_of_family_planning.diaphragm" type="checkbox"
                       name="374^METHOD OF FAMILY PLANNING^99DCT"
                       value="5278^DIAPHRAGM^99DCT">
                <label for="method_of_family_planning.diaphragm">Diaphragm / Cervical cap</label><br/>

                <input id="method_of_family_planning.oral_contraceptive_pills" type="checkbox"
                       name="374^METHOD OF FAMILY PLANNING^99DCT" value="780^ORAL CONTRACEPTION^99DCT">
                <label for="method_of_family_planning.oral_contraceptive_pills">Oral contraceptive pills</label><br/>

                <input id="method_of_family_planning.natural_family_planning" type="checkbox"
                       name="374^METHOD OF FAMILY PLANNING^99DCT" value="5277^NATURAL FAMILY PLANNING^99DCT">
                <label for="method_of_family_planning.natural_family_planning">Natural family planning</label><br/>

                <input id="method_of_family_planning.injectable_contraceptives" type="checkbox"
                       name="374^METHOD OF FAMILY PLANNING^99DCT" value="5279^INJECTABLE CONTRACEPTIVES^99DCT">
                <label for="method_of_family_planning.injectable_contraceptives">Injectable hormonesa</label><br/>

                <input id="method_of_family_planning.contraceptive_implant" type="checkbox"
                       name="374^METHOD OF FAMILY PLANNING^99DCT" value="6220^CONTRACEPTIVE IMPLANT^99DCT">
                <label for="method_of_family_planning.contraceptive_implant">Implant / Patching</label><br/>

                <input id="method_of_family_planning.none" type="checkbox" name="374^METHOD OF FAMILY PLANNING^99DCT"
                       value="1107^NONE^99DCT">
                <label for="method_of_family_planning.none">None</label><br/>

                <input id="method_of_family_planning.do_not_know" type="checkbox"
                       name="374^METHOD OF FAMILY PLANNING^99DCT" value="1624^DO NOT KNOW^99DCT">
                <label for="method_of_family_planning.do_not_know">Do not know</label><br/>
            </fieldset>
        </div>
    </div>

    <div class="section">
        <div class="form-group">
            <label>Prior PAP results</label>
            <fieldset name="7423^MOST RECENT PAPANICOLAOU SMEAR RESULT^99DCT"
                      data-concept="7423^MOST RECENT PAPANICOLAOU SMEAR RESULT^99DCT">
                <input id="recent_papanicolaou_result.normal" type="checkbox"
                       name="7423^MOST RECENT PAPANICOLAOU SMEAR RESULT^99DCT" value="1115^NORMAL^99DCT">
                <label for="recent_papanicolaou_result.normal">Normal</label><br/>

                <input id="recent_papanicolaou_result.atypical_squamous_cells_of_undetermined_significance"
                       type="checkbox"
                       name="7423^MOST RECENT PAPANICOLAOU SMEAR RESULT^99DCT"
                       value="7417^ATYPICAL SQUAMOUS CELLS OF UNDETERMINED SIGNIFICANCE ^99DCT">
                <label for="recent_papanicolaou_result.atypical_squamous_cells_of_undetermined_significance">
                    Atypical squamous cells of undetermined significance
                </label><br/>

                <input id="recent_papanicolaou_result.atypical_glandular_cells_of_undetermined_significance"
                       type="checkbox"
                       name="7423^MOST RECENT PAPANICOLAOU SMEAR RESULT^99DCT"
                       value="7418^ATYPICAL GLANDULAR CELLS OF UNDETERMINED SIGNIFICANCE ^99DCT">
                <label for="recent_papanicolaou_result.atypical_glandular_cells_of_undetermined_significance">
                    Atypical glandular cells of undetermined significance
                </label><br/>

                <input id="recent_papanicolaou_result.low_grade_squamous_intraepithelial_lesion" type="checkbox"
                       name="7423^MOST RECENT PAPANICOLAOU SMEAR RESULT^99DCT"
                       value="7419^LOW GRADE SQUAMOUS INTRAEPITHELIAL LESION^99DCT">
                <label for="recent_papanicolaou_result.low_grade_squamous_intraepithelial_lesion">
                    Low grade squamous intraepithelial lesion
                </label><br/>

                <input id="recent_papanicolaou_result.high_grade_squamous_intraepithelial_lesion" type="checkbox"
                       name="7423^MOST RECENT PAPANICOLAOU SMEAR RESULT^99DCT"
                       value="7420^HIGH GRADE SQUAMOUS INTRAEPITHELIAL LESION^99DCT">
                <label for="recent_papanicolaou_result.high_grade_squamous_intraepithelial_lesion">
                    High grade squamous intraepithelial lesion
                </label><br/>

                <input id="recent_papanicolaou_result.squamous_cell_carcinoma_not_otherwise_specified" type="checkbox"
                       name="7423^MOST RECENT PAPANICOLAOU SMEAR RESULT^99DCT"
                       value="7421^SQUAMOUS CELL CARCINOMA, NOT OTHERWISE SPECIFIED ^99DCT">
                <label for="recent_papanicolaou_result.squamous_cell_carcinoma_not_otherwise_specified">
                    Squamous cell carcinoma
                </label><br/>

                <input id="recent_papanicolaou_result.adenocarcinoma" type="checkbox"
                       name="7423^MOST RECENT PAPANICOLAOU SMEAR RESULT^99DCT" value="7422^ADENOCARCINOMA ^99DCT">
                <label for="recent_papanicolaou_result.adenocarcinoma">Adenocarcinoma</label><br/>

                <input id="recent_papanicolaou_result.do_not_know" type="checkbox"
                       name="7423^MOST RECENT PAPANICOLAOU SMEAR RESULT^99DCT" value="1624^DO NOT KNOW^99DCT">
                <label for="recent_papanicolaou_result.do_not_know">Do not know</label><br/>
            </fieldset>
        </div>
    </div>

    <div class="section">
        <div class="form-group">
            <label for="date_most_recent_papanicolaou_smear_performed">Date of most recent PAP result</label>
            <input class="form-control datepicker nonFutureDate" id="date_most_recent_papanicolaou_smear_performed"
                   name="date_most_recent_papanicolaou_smear_performed" type="date"
                   data-concept="6727^DATE MOST RECENT PAPANICOLAOU SMEAR PERFORMED^99DCT">
        </div>

        <div class="form-group">
            <label for="freetext_general">Comments</label>
            <input class="form-control" id="freetext_general" name="freetext_general" type="text"
                   data-concept="1915^FREETEXT GENERAL^99DCT">
        </div>
    </div>
</div>

<div class="form-group text-center">
    <input class="btn btn-primary" id="save_draft" type="button" value="Save"/>
    <input class="btn btn-primary" id="submit_form" type="button" value="Submit"/>
</div>
</form>
</body>

<script type="text/javascript">
    $(document).ready(function () {

        $('#save_draft').click(function () {
            document.saveDraft();
        });

        $('#submit_form').click(function () {
            document.submit();
        });

        $('#breastcancer_form').validate({
            rules: {
                pulse: {
                    number: true,
                    range: [0, 230]
                },
                temperature_c: {
                    number: true,
                    range: [25, 43]
                },
                weight_kg: {
                    number: true,
                    range: [0, 250]
                },
                height_cm: {
                    number: true,
                    range: [10, 228]
                },
                age_of_menarche: {
                    number: true,
                    range: [8, 23]
                },
                gravida: {
                    number: true,
                    min: 0
                },
                parity: {
                    number: true,
                    min: 0
                },
                age_of_first_pregnancy: {
                    number: true,
                    range: [8, 50]
                },
                mass_measurement_in_cm_second_direction: {
                    number: true,
                    min: 0
                },
                mass_measurement_in_cm_first_direction: {
                    number: true,
                    min: 0
                }
            },
            submitHandler: function (form) {
                $('#result').html(JSON.stringify($('form').serializeEncounterForm(), undefined, 2));
            }
        });

        var locationName = [
            {"val": "7", "label": "Chulaimbo"},
            {"val": "3", "label": "Turbo"},
            {"val": "17", "label": "Iten"},
            {"val": "2", "label": "Mosoriot"},
            {"val": "8", "label": "Webuye"},
            {"val": "9", "label": "Ampath MTRH"}
        ];
        $('#encounter\\.location_id').autocomplete({
            source: locationName,
            create: function (event, ui) {
                var location_val = $('input[name="encounter\\.location_id"]').val();
                $.each(locationName, function (i, elem) {
                    if (elem.val == location_val) {
                        $('#encounter\\.location_id').val(elem.label)
                    }
                    ;
                });
            },
            select: function (event, ui) {
                $('input[name="encounter\\.location_id"]').val(ui.item.val);
                $('#encounter\\.location_id').val(ui.item.label);
                return false;
            }
        });

        var provider = [
            {"label": "Daurine Achieng Agumba", "val": "3419-9"},
            {"label": "Irene Chepkosgei	Kurgat", "val": "3420-7"},
            {"label": "Rose	Cheruto	Toroitich", "val": "3421-5"},
            {"label": "Mary	Kipkurui Kimosop", "val": "3422-3"},
            {"label": "Jacqueline Chemom Ndiema", "val": "3423-1"},
            {"label": "Grace Wanjiru Mwangi", "val": "3424-9"},
            {"label": "Collette	Mabia Palapala", "val": "3425-6"},
            {"label": "Dorice Erima	Wekesa	Female", "val": "3426-4"},
            {"label": "Agnes Kagure	Boen", "val": "120-6"},
            {"label": "Linet Kerubo	Onyancha", "val": "3427-2"},
            {"label": "Delinah Muchai Tanui", "val": "1208-8"},
            {"label": "Hellen Mushimbi Indumbwe", "val": "1208-8"},
            {"label": "Lydia Cherugut Samoei", "val": "1525-5"},
            {"label": "Ruth	Kalunda	Nzili", "val": "1529-7"},
            {"label": "Lucy	Cheruto	Birgen", "val": "3428-0"},
            {"label": "Gratiah Nafuna Khaemba", "val": "1409-2"},
            {"label": "Leonida Chemutai	Mengich", "val": "1357-3"},
            {"label": "Ann Wangoi Maina", "val": "1412-6"},
            {"label": "Elkanah Omenge Orango", "val": "1474-6"},
            {"label": "Peter Mukhanadale Istura", "val": "1478-7"},
            {"label": "Hillary Mabeya", "val": "1476-1"},
            {"label": "Astrid Christoffersen Deb", "val": "1237-7"},
            {"label": "Philip Kipkirui Tonui", "val": "1485-7"}
        ];

        $('#encounter\\.provider_id_select').autocomplete({
            source: provider,
            create: function (event, ui) {
                var provider_val = $('input[name="encounter\\.provider_id_select"]').val();
                $.each(provider, function (i, elem) {
                    if (elem.val == provider_val) {
                        $('#encounter\\.provider_id_select').val(elem.label)
                    }
                });
            },
            select: function (event, ui) {
                $('input[name="encounter\\.provider_id_select"]').val(ui.item.val);
                $('#encounter\\.provider_id_select').val(ui.item.label);
                $('#encounter\\.provider_id').val(ui.item.val);
                $('.show_provider_id_text').hide();
                return false;
            }
        });
        $('#encounter\\.provider_id_select').change(function () {
            if ($('#encounter\\.provider_id_select').val() === '') {
                $('#encounter\\.provider_id').val('');
                $('.show_provider_id_text').show();
            }
        });

        /* Start - Ensuring some selection are selected alone */
        $.fn.checkSelectedAlone = function (nameArray, singleValues, message) {
            var $validator = $('form').validate();
            var errors = {};
            var final_result = true;
            $.each(nameArray, function (i, elem) {
                var filedSetElem = $('fieldset[name="' + elem + '"]');
                var result = isValidForSelection(filedSetElem, singleValues);
                if (!result) {
                    errors[elem] = message;
                    final_result = false;
                }
            });
            if (!final_result) {
                $validator.showErrors(errors);
            }
            return final_result;
        };

        var isValidForSelection = function (element, singleValues) {
            var $fieldset = $(element);
            if ($fieldset.prop('tagName') != 'FIELDSET') {
                return true;
            }
            var result = true;
            var totalSelected = $fieldset.find('input:checkbox:checked').length;
            if (totalSelected > 1) {
                $.each($fieldset.find('input:checkbox:checked'), function (i, cBoxElement) {
                    $.each(singleValues, function (i, singleValue) {
                        if ($(cBoxElement).val() == singleValue) {
                            result = false;
                        }
                    });
                })
            }
            return result;
        };
        /* End - Ensuring some selection are selected alone */

        /* Start - Example of calling above validation */
        // none for complaints
        var complaintsName = ['5219^CHIEF COMPLAINT^99DCT'];
        var complaintsSingleValues = ['1107^NONE^99DCT'];
        var complaintsMessage = "If None is selected, it should be the only option.";

        // none and don't know for the family planning
        var familyPlanningName = ['8253^FAMILY PLANNING METHOD EVER USED^99DCT'];
        var familyPlanningSingleValues = ['1624^DO NOT KNOW^99DCT', '1107^NONE^99DCT'];
        var familyPlanningMessage = "If None or Don't know is selected, it should be the only option.";

        // normal for papanicolaou exam
        var papanicolaouName = ['7423^MOST RECENT PAPANICOLAOU SMEAR RESULT^99DCT'];
        var papanicolaouSingleValues = ['1115^NORMAL^99DCT', '1624^DO NOT KNOW^99DCT'];
        var papanicolaouMessage = "If Normal or Don't Know is selected, it should be the only option.";

        $.fn.customValidationCheck = function () {
            return $.fn.checkSelectedAlone(complaintsName, complaintsSingleValues, complaintsMessage)
                    && $.fn.checkSelectedAlone(familyPlanningName, familyPlanningSingleValues, familyPlanningMessage)
                    && $.fn.checkSelectedAlone(papanicolaouName, papanicolaouSingleValues, papanicolaouMessage)
        };
        /* End - Example of calling above validation */
    });
</script>

</html>
